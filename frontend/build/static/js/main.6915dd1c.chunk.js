(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{179:function(e,t,a){},180:function(e,t,a){},272:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a(32),c=a.n(r),s=(a(179),a(41)),i=a.n(s),o=a(1),l=a(58),u=a(6),d=(a(180),a(278)),b=a(173),j=a(42),h=a(279),m=a(276),p=a(280),x=a(277),f=a(121),O=a(93),g=a(72),k=a.n(g),y="https://ticket.huarongdao.xyz/api",v=a(14),I=d.a.TabPane;var N=function(){var e=Object(n.useState)([]),t=Object(u.a)(e,2),a=t[0],r=t[1],c=Object(n.useState)([]),s=Object(u.a)(c,2),g=s[0],N=s[1],w=Object(n.useState)(!1),S=Object(u.a)(w,2),C=S[0],q=S[1],F=Object(n.useState)(!1),T=Object(u.a)(F,2),A=T[0],z=T[1],B=Object(n.useState)(""),E=Object(u.a)(B,2),L=E[0],P=E[1],D=function(){return q(!C)},J=Object(n.useState)(localStorage.getItem("token")||""),K=Object(u.a)(J,2),G=K[0],R=K[1],V={headers:{Authorization:G}},H=function(e){G&&k.a.get("".concat(y,"/tickets"),{params:{exhibition:e},headers:{Authorization:G}}).then((function(t){"chagall"===e?N(t.data):"japan"===e&&r(t.data)})).catch((function(t){b.a.error({message:"Error",description:"\u83b7\u53d6".concat(e,"\u6570\u636e\u5931\u8d25\uff01")}),console.error(t)}))};Object(n.useEffect)((function(){H("japan"),H("chagall")}),[G]);var M=function(e){for(var t=e.toString();t.length<5;)t="0"+t;return t},Q=[{title:"\u7968\u53f7",dataIndex:"ticketNumber",render:function(e){return M(e)},sorter:function(e,t){return e.ticketNumber-t.ticketNumber},defaultSortOrder:"ascend"},{title:"\u6536\u7968\u65b9",dataIndex:"client"},{title:"\u7ecf\u624b\u4eba",dataIndex:"operator"},{title:"\u7968\u79cd",dataIndex:"type"},{title:"\u65e5\u671f",dataIndex:"date",render:function(e){return new Date(e).toLocaleDateString()}},{title:"\u5907\u6ce8",dataIndex:"notes"},{title:"\u6838\u9500",dataIndex:"verified",render:function(e){return e?"\u662f":"\u5426"}},{title:"\u64cd\u4f5c",render:function(e,t){return Object(v.jsxs)(v.Fragment,{children:[t.verified?null:Object(v.jsx)(j.a,{type:"primary",ghost:!0,size:"small",onClick:function(){k.a.patch("".concat(y,"/ticket/status"),{exhibition:t.exhibition,ticketNumber:t.ticketNumber,verified:!0},V).then((function(){H(t.exhibition),b.a.success({message:"\u6838\u9500\u6210\u529f"})})).catch((function(e){console.error(e),b.a.error({message:"\u6838\u9500\u5931\u8d25"})}))},children:"\u6838\u9500"}),Object(v.jsx)(j.a,{style:{marginLeft:5},danger:!0,size:"small",onClick:function(){k.a.delete("".concat(y,"/ticket"),{headers:V.headers,data:{exhibition:t.exhibition,ticketNumber:t.ticketNumber}}).then((function(){H(t.exhibition),b.a.success({message:"\u5220\u9664\u6210\u529f"})})).catch((function(e){console.error(e),b.a.error({message:"\u5220\u9664\u5931\u8d25"})}))},children:"\u5220\u9664"})]})}}],U=function(e){return L?e.filter((function(e){return JSON.stringify(e).includes(L)})):e},W=Object(v.jsx)(h.a.Search,{onSearch:function(e){return P(e)},style:{width:200,marginBottom:5,float:"left"},allowClear:!0}),X=Object(v.jsxs)("div",{className:"App",children:[Object(v.jsxs)(d.a,{defaultActiveKey:"japan",tabBarExtraContent:Object(v.jsx)(j.a,{size:"small",onClick:D,type:"primary",children:"\u6dfb\u52a0\u7eb8\u8d28\u7968"}),children:[Object(v.jsxs)(I,{tab:"Japan",children:[W,Object(v.jsx)(m.a,{columns:Q,dataSource:U(a),rowKey:function(e){return e.ticketNumber}})]},"japan"),Object(v.jsxs)(I,{tab:"Chagall",children:[W,Object(v.jsx)(m.a,{columns:Q,dataSource:U(g),rowKey:function(e){return e.ticketNumber}})]},"chagall")]}),Object(v.jsx)(p.a,{title:"\u6dfb\u52a0\u7eb8\u8d28\u7968",visible:C,onCancel:D,okButtonProps:{htmlType:"submit",form:"addTicket"},children:Object(v.jsxs)(x.a,{onFinish:function(){var e=Object(l.a)(i.a.mark((function e(t){var a,n,r,c,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={exhibition:t.exhibition,date:new Date,operator:t.operator,client:t.client,type:t.type,notes:t.notes||"",verified:!1},!A){e.next=11;break}if(!(t.ticketNumbers.end<t.ticketNumbers.start)){e.next=5;break}return b.a.error({message:"\u7968\u53f7\u9519\u8bef",description:"\u8d77\u59cb\u7968\u53f7\u5fc5\u987b\u5c0f\u4e8e\u7ed3\u675f\u7968\u53f7\uff01"}),e.abrupt("return");case 5:for(n=t.ticketNumbers,r={exhibition:t.exhibition,documents:[]},c=Number.parseInt(n.start);c<=Number.parseInt(n.end);c++)r.documents.push(Object(o.a)(Object(o.a)({},a),{},{ticketNumber:M(c)}));k.a.post("".concat(y,"/tickets"),r,V).then((function(e){H(t.exhibition),b.a.success({message:"\u6210\u529f",description:"\u6210\u529f\u6dfb\u52a0".concat(r.documents.length,"\u6761\u7eb8\u8d28\u7968\u8bb0\u5f55")}),D()})).catch((function(e){e.response?409===e.response.status&&b.a.warn({message:"\u7968\u53f7\u51b2\u7a81",description:"\u6709\u4e00\u90e8\u5206\u6216\u6240\u6709\u7968\u53f7\u51b2\u7a81\uff0c\u8bf7\u91cd\u65b0\u6dfb\u52a0"}):b.a.error({message:"\u5931\u8d25",description:"\u6dfb\u52a0\u7eb8\u8d28\u7968\u8bb0\u5f55\u5931\u8d25"})})),e.next=13;break;case 11:s=Object(o.a)(Object(o.a)({},a),{},{ticketNumber:t.ticketNumber}),k.a.post("".concat(y,"/ticket"),s,V).then((function(e){H(t.exhibition),b.a.success({message:"\u6210\u529f",description:"\u6210\u529f\u6dfb\u52a01\u6761\u7eb8\u8d28\u7968\u8bb0\u5f55"}),D()})).catch((function(e){e.response?409===e.response.status&&b.a.error({message:"\u7968\u53f7\u51b2\u7a81",description:"\u7968\u53f7\u51b2\u7a81\uff0c\u8bf7\u91cd\u65b0\u6dfb\u52a0"}):b.a.error({message:"\u5931\u8d25",description:"\u6dfb\u52a0\u7eb8\u8d28\u7968\u8bb0\u5f55\u5931\u8d25"})}));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),name:"addTicket",labelCol:{span:4,offset:2},wrapperCol:{span:16},children:[Object(v.jsx)(x.a.Item,{label:"\u5c55\u89c8",name:"exhibition",rules:[{required:!0,message:"\u5fc5\u987b\u9009\u62e9\u5c55\u89c8"}],children:Object(v.jsxs)(f.a.Group,{children:[Object(v.jsx)(f.a,{value:"japan",children:"\u65e5\u672c\u52a8\u6f2b"}),Object(v.jsx)(f.a,{value:"chagall",children:"\u590f\u52a0\u5c14"})]})}),Object(v.jsx)(x.a.Item,{label:"\u7968\u53f7",children:Object(v.jsxs)(h.a.Group,{compact:!0,children:[Object(v.jsxs)(O.a,{defaultValue:1,onChange:function(e){z(1!==e)},children:[Object(v.jsx)(O.a.Option,{value:1,children:"\u5355\u5f20"}),Object(v.jsx)(O.a.Option,{value:2,children:"\u8fde\u53f7"})]}),A?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(x.a.Item,{name:["ticketNumbers","start"],noStyle:!0,rules:[{required:!0,message:"\u7968\u53f7\u5fc5\u987b\u8f93\u5165"},{pattern:/[0-9]/,message:"\u7968\u53f7\u53ea\u80fd\u662f\u6570\u5b57"},{max:5,message:"\u7968\u53f7\u4e0d\u80fd\u8d85\u8fc75\u4f4d"}],children:Object(v.jsx)(h.a,{style:{width:80,textAlign:"center"},placeholder:"\u8d77\u59cb"})}),Object(v.jsx)(h.a,{style:{width:30,borderLeft:0,borderRight:0,pointerEvents:"none",backgroundColor:"#fff"},placeholder:"~",disabled:!0}),Object(v.jsx)(x.a.Item,{name:["ticketNumbers","end"],rules:[{required:!0,message:"\u7968\u53f7\u5fc5\u987b\u8f93\u5165"},{pattern:/[0-9]/,message:"\u7968\u53f7\u53ea\u80fd\u662f\u6570\u5b57"},{max:5,message:"\u7968\u53f7\u4e0d\u80fd\u8d85\u8fc75\u4f4d"}],noStyle:!0,children:Object(v.jsx)(h.a,{className:"site-input-right",style:{width:80,textAlign:"center"},placeholder:"\u7ed3\u675f"})})]}):Object(v.jsx)(x.a.Item,{name:"ticketNumber",noStyle:!0,rules:[{required:!0,message:"\u7968\u53f7\u5fc5\u987b\u8f93\u5165"},{pattern:/[0-9]/,message:"\u7968\u53f7\u53ea\u80fd\u662f\u6570\u5b57"},{max:5,message:"\u7968\u53f7\u4e0d\u80fd\u8d85\u8fc75\u4f4d"}],children:Object(v.jsx)(h.a,{style:{width:200}})})]})}),Object(v.jsx)(x.a.Item,{label:"\u6536\u7968\u65b9",name:"client",rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u6536\u7968\u65b9"}],children:Object(v.jsx)(h.a,{})}),Object(v.jsx)(x.a.Item,{label:"\u7ecf\u624b\u4eba",name:"operator",rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u7ecf\u624b\u4eba"}],children:Object(v.jsx)(h.a,{})}),Object(v.jsx)(x.a.Item,{label:"\u7968\u79cd",name:"type",rules:[{required:!0,message:"\u5fc5\u987b\u8f93\u5165\u7968\u79cd"}],children:Object(v.jsx)(h.a,{})}),Object(v.jsx)(x.a.Item,{label:"\u5907\u6ce8",name:"notes",children:Object(v.jsx)(h.a.TextArea,{row:4})})]})})]}),Y=Object(v.jsx)("div",{children:Object(v.jsx)(p.a,{okButtonProps:{htmlType:"submit",form:"auth"},title:"\u8bf7\u8f93\u5165\u5bc6\u7801",visible:!0,children:Object(v.jsx)(x.a,{name:"auth",onFinish:function(e){k.a.post("".concat(y,"/auth"),{password:e.password}).then((function(e){localStorage.setItem("token",e.data.token),R(e.data.token)})).catch((function(e){console.error(e),b.a.error({message:"\u767b\u5f55\u5931\u8d25"})}))},children:Object(v.jsx)(x.a.Item,{name:"password",rules:[{required:!0}],label:"\u5bc6\u7801",children:Object(v.jsx)(h.a,{})})})})});return G?X:Y},w=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,281)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),c(e),s(e)}))};c.a.render(Object(v.jsx)(N,{}),document.getElementById("root")),w()}},[[272,1,2]]]);
//# sourceMappingURL=main.6915dd1c.chunk.js.map